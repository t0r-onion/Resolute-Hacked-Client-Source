package vip.Resolute.modules.impl.exploit;

import vip.Resolute.Resolute;
import vip.Resolute.events.Event;
import vip.Resolute.events.impl.EventMotion;
import vip.Resolute.settings.impl.NumberSetting;
import vip.Resolute.ui.notification.Notification;
import vip.Resolute.ui.notification.NotificationType;
import vip.Resolute.util.misc.TimerUtil;
import com.google.gson.Gson;
import com.google.gson.JsonObject;
import lombok.SneakyThrows;
import net.minecraft.client.Minecraft;
import org.apache.commons.io.FileUtils;

import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.util.concurrent.CompletableFuture;
import vip.Resolute.modules.Module;

public class StaffDetector extends Module {
    private final Gson gson = new Gson();
    private final TimerUtil timer = new TimerUtil();
    public final File directory = new File(Minecraft.getMinecraft().mcDataDir, "resolute");
    public final File configDir = new File(directory, "API");
    public int cachedBanCount;

    public NumberSetting delay = new NumberSetting("Delay in seconds", 30, 6, 60, 1);

    public StaffDetector() {
        super("StaffDetector", 0, "Detects staff and watchdog bans", Category.EXPLOIT);
        this.addSettings(delay);
    }

    @Override
    public void onEnable() {
        super.onEnable();
        if (Resolute.instance.api.equals("")) {
            Resolute.getNotificationManager().add(new Notification("Invalid API Key", "Provide a proper api key using .api", 5000L, NotificationType.WARNING));
            this.toggle();
        }
        cachedBanCount = 0;
        timer.reset();
    }

    public void onEvent(Event e) {
        if (e instanceof EventMotion) {
            if (e.isPre()) {
                if (timer.hasElapsed((long) (delay.getValue() * 1000))) {
                    CompletableFuture.runAsync(new Runnable() {
                        @SneakyThrows
                        @Override
                        public void run() {
                            //   JsonObject response = getContents();
                            if (cachedBanCount != 0) {
                                //     int banned = response.get("staff_total").getAsInt() - cachedBanCount;
                                //         if (banned != 0) {
                                //                  Resolute.getNotificationManager().add(new Notification("Staff Analyser", "Staff banned " + banned + "players!", 6000L, NotificationType.WARNING));
                            }
                        }
                        //     cachedBanCount = response.get("staff_total").getAsInt();
                        //           }
                        //       });
                        //             timer.reset();
                    });
                    //          }
                    //       }
//    }
/*
    @SneakyThrows
    private JsonObject getContents() {
        try {
            FileUtils.copyURLToFile(new URL("https://api.hypixel.net/watchdogStats?key=" + Resolute.instance.api), configDir, 2000, 1000);
        }catch(IOException e){
            e.printStackTrace();
        }


       return gson.fromJson(FileUtils.readFileToString(configDir), JsonObject.class);
 */
                }
            }
        }
    }
}

